<!DOCTYPE html>
<html>
<head>
  <title>Get OTP via Renew</title>
  <style>
    body { font-family: Arial; max-width: 500px; margin: 50px auto; }
    input, button { width: 100%; margin-top: 10px; padding: 10px; }
    #result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Get OTP (Renew)</h2>
  <input type="text" id="phone" placeholder="Enter phone number (e.g. 15408216184)">
  <button onclick="getOTP()">Get OTP</button>
  <div id="result">...</div>

  <script>
    const proxy = 'https://slotp1.akhiem-1987.workers.dev/fetch?url='
    const apiKey = 'jI2NOQNevdeEzdBaAqiQr4PKKdecUy'

    async function getOTP() {
      const phone = document.getElementById('phone').value.replace(/^\+?1/, '')
      const result = document.getElementById('result')
      result.textContent = '‚è≥ Finding activation ID...'

      // Fetch data.txt (ID|phone)
      const dataText = await fetch('data.txt').then(r => r.text())
      const lines = dataText.trim().split('\n')
      const match = lines.find(line => line.split('|')[1] === phone)

      if (!match) {
        result.textContent = '‚ùå No activation ID found for this phone.'
        return
      }

      const oldId = match.split('|')[0]

      // Step 1: getExtraActivation
      result.textContent = 'üîÑ Calling getExtraActivation...'
      const extraUrl = `${proxy}${encodeURIComponent(`https://daisysms.com/stubs/handler_api.php?api_key=${apiKey}&action=getExtraActivation&activationId=${oldId}`)}`
      const extraResp = await fetch(extraUrl).then(r => r.text())

      if (!extraResp.startsWith('ASLEEP:')) {
        result.textContent = '‚ùå Failed to renew ID. Response: ' + extraResp
        return
      }

      const newId = extraResp.split(':')[1]

      // Step 2: getStatus
      result.textContent = 'üì¶ Waiting for OTP... (ID: ' + newId + ')'
      const statusUrl = `${proxy}${encodeURIComponent(`https://daisysms.com/stubs/handler_api.php?api_key=${apiKey}&action=getStatus&id=${newId}`)}`
      const statusResp = await fetch(statusUrl).then(r => r.text())

      if (statusResp.startsWith('STATUS_OK:')) {
        const otp = statusResp.split(':')[1]
        result.textContent = '‚úÖ OTP: ' + otp
      } else {
        result.textContent = '‚ùå No OTP yet. Response: ' + statusResp
      }
    }
  </script>
</body>
</html>
