async function getOTP() {
  const phone = document.getElementById('phone').value.replace(/^\+?1/, '')
  const result = document.getElementById('result')
  result.textContent = 'â³ Finding activation ID...'

  try {
    const dataText = await fetch('data.txt').then(r => r.text())
    const lines = dataText.trim().split('\n')
    const match = lines.find(line => line.split('|')[1] === phone)

    if (!match) {
      result.textContent = 'âŒ No activation ID found for this phone.'
      return
    }

    const oldId = match.split('|')[0]

    // Step 1: getExtraActivation
    result.textContent = 'ğŸ”„ Renewing activation ID...'
    const extraUrl = `${proxy}${encodeURIComponent(`https://daisysms.com/stubs/handler_api.php?api_key=${apiKey}&action=getExtraActivation&activationId=${oldId}`)}`
    const extraResp = await fetch(extraUrl).then(r => r.text())

    if (!extraResp.startsWith('ASLEEP:')) {
      result.textContent = 'âŒ Failed to renew. Response: ' + extraResp
      return
    }

    const newId = extraResp.split(':')[1]
    result.textContent = `ğŸ“¦ New ID: ${newId}\nâŒ› Waiting for OTP...`

    // Step 2: getStatus loop
    let attempts = 0, maxTries = 15
    while (attempts < maxTries) {
      const statusUrl = `${proxy}${encodeURIComponent(`https://daisysms.com/stubs/handler_api.php?api_key=${apiKey}&action=getStatus&id=${newId}`)}`
      try {
        const statusResp = await fetch(statusUrl).then(r => r.text())

        if (statusResp.startsWith('STATUS_OK:')) {
          const parts = statusResp.split(':')
          const otp = parts[1]
          result.textContent = `âœ… OTP: ${otp}`
          return
        } else if (statusResp.includes('NO_ACTIVATION') || statusResp.includes('BAD')) {
          result.textContent = `âŒ Error: ${statusResp}`
          return
        } else {
          result.textContent = `âŒ› Waiting... (${attempts + 1}/${maxTries})\nStatus: ${statusResp}`
        }
      } catch (err) {
        result.textContent = `âŒ Fetch error: ${err.message}`
        return
      }

      await new Promise(r => setTimeout(r, 2000))
      attempts++
    }

    result.textContent = 'âŒ Timeout. No OTP received.'
  } catch (err) {
    result.textContent = `âŒ Unexpected error: ${err.message}`
  }
}
